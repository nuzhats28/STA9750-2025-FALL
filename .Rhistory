# --- 2. Proportion test: Has the fraction of negative revisions increased post-2000? ---
ces_full <- ces_full %>%
mutate(
post2000 = year >= 2000,
negative_revision = revision < 0
)
neg_counts <- ces_full %>%
group_by(post2000) %>%
summarize(
neg_rev = sum(negative_revision, na.rm = TRUE),
total = n(),
.groups = "drop"
)
prop_test_neg <- prop.test(x = neg_counts$neg_rev, n = neg_counts$total)
print(prop_test_neg)
# --- 3. Proportion test: Fraction of revisions >1% pre/post-2020 ---
ces_full <- ces_full %>%
mutate(
post2020 = year >= 2020,
large_revision = abs(revision_pct) > 0.01
)
large_counts <- ces_full %>%
group_by(post2020) %>%
summarize(
large_rev = sum(large_revision, na.rm = TRUE),
total = n(),
.groups = "drop"
)
prop_test_large <- prop.test(x = large_counts$large_rev, n = large_counts$total)
print(prop_test_large)
# --- 4. Correlation: Are revisions larger when CES level change is larger? ---
ces_full <- ces_full %>%
arrange(date) %>%
mutate(level_change = c(NA, diff(level)))
# Remove first NA
ces_corr <- cor.test(ces_full$revision[-1], ces_full$level_change[-1])
print(ces_corr)
# --- 5. t-test: Compare average revision pre- and post-2020 (only if both groups exist) ---
if(length(unique(ces_full$post2020)) == 2){
t_test_post2020 <- t.test(revision ~ post2020, data = ces_full)
print(t_test_post2020)
} else {
message("t-test skipped: post2020 factor does not have 2 levels")
}
# --- End of Task 4 ---
# --- Load libraries ---
library(dplyr)
library(lubridate)
library(ggplot2)
library(tidyr)
# --- 1. Create Presidents Party Table ---
presidents_party <- tidyr::expand_grid(
year = 1979:2025,
month = month.name,
president = NA_character_,
party = NA_character_
) %>%
mutate(president = case_when(
(month == "January")  & (year == 1979) ~ "Carter",
(month == "February") & (year == 1981) ~ "Reagan",
(month == "February") & (year == 1989) ~ "Bush 41",
(month == "February") & (year == 1993) ~ "Clinton",
(month == "February") & (year == 2001) ~ "Bush 43",
(month == "February") & (year == 2009) ~ "Obama",
(month == "February") & (year == 2017) ~ "Trump I",
(month == "February") & (year == 2021) ~ "Biden",
(month == "February") & (year == 2025) ~ "Trump II",
TRUE ~ NA_character_
)) %>%
tidyr::fill(president) %>%
mutate(party = if_else(president %in% c("Carter", "Clinton", "Obama", "Biden"), "D", "R"))
# --- 2. Join CES Data with President Party Table ---
ces_full <- ces_full %>%
mutate(year = year(date),
month = month(date, label = TRUE, abbr = FALSE))
ces_full_party <- ces_full %>%
left_join(presidents_party, by = c("year", "month"))
# --- 3. Example Claim 1 (Fake Politician) ---
# Claim: "Since 2020, BLS revisions have mostly been negative, showing jobs growth is overstated."
# Fact check with hypothesis test: fraction of negative revisions post-2020 > 0.5
ces_post2020 <- ces_full %>%
filter(year >= 2020) %>%
mutate(negative_revision = revision < 0)
# Count negative revisions
neg_counts <- ces_post2020 %>%
summarize(
neg_rev = sum(negative_revision, na.rm = TRUE),
total = n()
)
# Proportion test against 0.5
prop_test_claim1 <- prop.test(neg_counts$neg_rev, neg_counts$total, p = 0.5)
print(prop_test_claim1)
# --- 4. Example Claim 2 (Fake Politician) ---
# Claim: "Largest revisions happen under Republican presidents."
# Compare average absolute revision under R vs D presidents
ces_full_party <- ces_full_party %>%
mutate(abs_revision = abs(revision))
avg_rev_party <- ces_full_party %>%
group_by(party) %>%
summarize(avg_abs_revision = mean(abs_revision, na.rm = TRUE))
print(avg_rev_party)
# t-test for difference between parties
if(length(unique(ces_full_party$party)) == 2){
t_test_party <- t.test(abs_revision ~ party, data = ces_full_party)
print(t_test_party)
}
# --- 5. Visualizations for Fact Checks ---
# 5a. Absolute CES Revisions Over Time
ggplot(ces_full, aes(x = date, y = abs(revision))) +
geom_line(color = "purple") +
labs(title = "Absolute CES Revisions Over Time", y = "Absolute Revision", x = "Date")
# 5b. Fraction of Negative Revisions by Year
neg_by_year <- ces_full %>%
group_by(year) %>%
summarize(frac_negative = mean(revision < 0, na.rm = TRUE))
ggplot(neg_by_year, aes(x = year, y = frac_negative)) +
geom_line(color = "red") +
labs(title = "Fraction of Negative CES Revisions by Year", y = "Fraction Negative", x = "Year")
# --- 6. Key Statistics to Include in Fact Check ---
# Largest positive and negative revisions
largest_revision <- ces_full %>% slice_max(revision, n = 1)
smallest_revision <- ces_full %>% slice_min(revision, n = 1)
# Average revision post-2020
avg_post2020 <- ces_full %>% filter(year >= 2020) %>% summarize(avg_revision = mean(revision, na.rm = TRUE))
# Combine into a table
fact_check_stats <- list(
largest_revision = largest_revision,
smallest_revision = smallest_revision,
avg_post2020 = avg_post2020,
prop_test_claim1 = prop_test_claim1,
avg_rev_party = avg_rev_party
)
fact_check_stats
# --- Extra Credit: Computationally-Intensive Inference (Robust Version) ---
# Install/load packages
if(!require(infer)) install.packages("infer")
library(dplyr)
library(ggplot2)
library(infer)
library(tidyr)
# --- 1. Flowchart / Schematic ---
flowchart_data <- tibble(
step = factor(1:4),
label = c(
"1. Take original CES revision data",
"2. Resample with replacement (bootstrap) or shuffle labels (permutation)",
"3. Compute statistic (mean, median, proportion, etc.) for each resample",
"4. Compare observed statistic to resampled distribution to get p-value / confidence interval"
),
x = c(1, 2, 3, 4),
y = c(1, 1, 1, 1)
)
ggplot(flowchart_data, aes(x = x, y = y)) +
geom_point(size = 5) +
geom_text(aes(label = label), vjust = -1.5) +
geom_segment(aes(xend = lead(x), yend = lead(y)),
arrow = arrow(length = unit(0.2, "inches")), na.rm = TRUE) +
xlim(0.5, 4.5) + ylim(0.5, 1.5) +
theme_void() +
labs(title = "Schematic of Computationally-Intensive Inference")
# --- 2. Bootstrap test: mean revision ---
set.seed(123)
boot_means <- ces_full %>%
specify(response = revision) %>%
generate(reps = 1000, type = "bootstrap") %>%
calculate(stat = "mean")
observed_mean <- mean(ces_full$revision, na.rm = TRUE)
boot_ci <- quantile(boot_means$stat, c(0.025, 0.975))
cat("Bootstrap 95% CI for mean revision:", boot_ci, "\nObserved mean:", observed_mean, "\n")
# --- 3. Bootstrap test: probability of positive revisions ---
# Convert to numeric 0/1
ces_full <- ces_full %>%
mutate(positive_revision_num = as.numeric(revision > 0))
set.seed(123)
boot_prop <- ces_full %>%
specify(response = positive_revision_num) %>%
generate(reps = 1000, type = "bootstrap") %>%
calculate(stat = "mean")  # mean = proportion
observed_prop <- mean(ces_full$positive_revision_num, na.rm = TRUE)
boot_prop_ci <- quantile(boot_prop$stat, c(0.025, 0.975))
cat("Bootstrap 95% CI for probability of positive revision:", boot_prop_ci,
"\nObserved proportion:", observed_prop, "\n")
# --- 4. Permutation test: median revision pre/post-2020 ---
ces_full <- ces_full %>% mutate(post2020 = year >= 2020)
if(length(unique(ces_full$post2020)) == 2){
set.seed(123)
perm_median <- ces_full %>%
specify(response = revision, explanatory = post2020) %>%
hypothesize(null = "independence") %>%
generate(reps = 1000, type = "permute") %>%
calculate(stat = "diff in medians")
observed_diff_median <- median(ces_full$revision[ces_full$post2020], na.rm = TRUE) -
median(ces_full$revision[!ces_full$post2020], na.rm = TRUE)
p_value_perm <- mean(abs(perm_median$stat) >= abs(observed_diff_median))
cat("Permutation test for median revision difference post-2020 vs pre-2020\nObserved difference:",
observed_diff_median, "p-value:", p_value_perm, "\n")
} else {
message("Permutation test skipped: post2020 factor does not have 2 levels")
}
# --- End of Extra Credit Code ---
# --- Task 4: Statistical Inference on CES Revisions ---
library(dplyr)
# Ensure numeric columns
ces_full <- ces_full %>%
mutate(
revision = as.numeric(revision),
revision_pct = as.numeric(revision_pct)
)
# --- 1. t-test: Is the average revision significantly different from zero? ---
t_test_avg <- t.test(ces_full$revision, mu = 0)
print(t_test_avg)
# --- 2. Proportion test: Has the fraction of negative revisions increased post-2000? ---
ces_full <- ces_full %>%
mutate(
post2000 = year >= 2000,
negative_revision = revision < 0
)
neg_counts <- ces_full %>%
group_by(post2000) %>%
summarize(
neg_rev = sum(negative_revision, na.rm = TRUE),
total = n(),
.groups = "drop"
)
prop_test_neg <- prop.test(x = neg_counts$neg_rev, n = neg_counts$total)
print(prop_test_neg)
# --- 3. Proportion test: Fraction of revisions >1% pre/post-2020 ---
ces_full <- ces_full %>%
mutate(
post2020 = year >= 2020,
large_revision = abs(revision_pct) > 0.01
)
large_counts <- ces_full %>%
group_by(post2020) %>%
summarize(
large_rev = sum(large_revision, na.rm = TRUE),
total = n(),
.groups = "drop"
)
prop_test_large <- prop.test(x = large_counts$large_rev, n = large_counts$total)
print(prop_test_large)
# --- 4. Correlation: Are revisions larger when CES level change is larger? ---
ces_full <- ces_full %>%
arrange(date) %>%
mutate(level_change = c(NA, diff(level)))
# Remove first NA for correlation
ces_corr <- cor.test(ces_full$revision[-1], ces_full$level_change[-1])
print(ces_corr)
# --- 5. t-test: Compare average revision pre- and post-2020 (only if both groups exist) ---
if(length(unique(ces_full$post2020)) == 2){
t_test_post2020 <- t.test(revision ~ post2020, data = ces_full)
print(t_test_post2020)
} else {
message("t-test skipped: post2020 factor does not have 2 levels")
}
# --- End of Task 4 ---
library(dplyr)
ces_full <- ces_full %>%
mutate(
revision = as.numeric(revision),
revision_pct = as.numeric(revision_pct)
)
t_test_avg <- t.test(ces_full$revision, mu = 0)
print(t_test_avg)
ces_full <- ces_full %>%
mutate(
post2000 = year >= 2000,
negative_revision = revision < 0
)
neg_counts <- ces_full %>%
group_by(post2000) %>%
summarize(
neg_rev = sum(negative_revision, na.rm = TRUE),
total = n(),
.groups = "drop"
)
prop_test_neg <- prop.test(x = neg_counts$neg_rev, n = neg_counts$total)
print(prop_test_neg)
ces_full <- ces_full %>%
mutate(
post2020 = year >= 2020,
large_revision = abs(revision_pct) > 0.01
)
large_counts <- ces_full %>%
group_by(post2020) %>%
summarize(
large_rev = sum(large_revision, na.rm = TRUE),
total = n(),
.groups = "drop"
)
prop_test_large <- prop.test(x = large_counts$large_rev, n = large_counts$total)
print(prop_test_large)
ces_full <- ces_full %>%
arrange(date) %>%
mutate(level_change = c(NA, diff(level)))
ces_corr <- cor.test(ces_full$revision[-1], ces_full$level_change[-1])
print(ces_corr)
if(length(unique(ces_full$post2020)) == 2){
t_test_post2020 <- t.test(revision ~ post2020, data = ces_full)
print(t_test_post2020)
} else {
message("t-test skipped: post2020 factor does not have 2 levels")
}
library(dplyr)
library(lubridate)
library(ggplot2)
library(tidyr)
presidents_party <- tidyr::expand_grid(
year = 1979:2025,
month = month.name,
president = NA_character_,
party = NA_character_
) %>%
mutate(president = case_when(
(month == "January")  & (year == 1979) ~ "Carter",
(month == "February") & (year == 1981) ~ "Reagan",
(month == "February") & (year == 1989) ~ "Bush 41",
(month == "February") & (year == 1993) ~ "Clinton",
(month == "February") & (year == 2001) ~ "Bush 43",
(month == "February") & (year == 2009) ~ "Obama",
(month == "February") & (year == 2017) ~ "Trump I",
(month == "February") & (year == 2021) ~ "Biden",
(month == "February") & (year == 2025) ~ "Trump II",
TRUE ~ NA_character_
)) %>%
tidyr::fill(president) %>%
mutate(party = if_else(president %in% c("Carter", "Clinton", "Obama", "Biden"), "D", "R"))
ces_full <- ces_full %>%
mutate(year = year(date),
month = month(date, label = TRUE, abbr = FALSE))
ces_full_party <- ces_full %>%
left_join(presidents_party, by = c("year", "month"))
ces_post2020 <- ces_full %>%
filter(year >= 2020) %>%
mutate(negative_revision = revision < 0)
neg_counts <- ces_post2020 %>%
summarize(
neg_rev = sum(negative_revision, na.rm = TRUE),
total = n()
)
prop_test_claim1 <- prop.test(neg_counts$neg_rev, neg_counts$total, p = 0.5)
print(prop_test_claim1)
ces_full_party <- ces_full_party %>%
mutate(abs_revision = abs(revision))
avg_rev_party <- ces_full_party %>%
group_by(party) %>%
summarize(avg_abs_revision = mean(abs_revision, na.rm = TRUE))
print(avg_rev_party)
if(length(unique(ces_full_party$party)) == 2){
t_test_party <- t.test(abs_revision ~ party, data = ces_full_party)
print(t_test_party)
}
ggplot(ces_full, aes(x = date, y = abs(revision))) +
geom_line(color = "purple") +
labs(title = "Absolute CES Revisions Over Time", y = "Absolute Revision", x = "Date")
neg_by_year <- ces_full %>%
group_by(year) %>%
summarize(frac_negative = mean(revision < 0, na.rm = TRUE))
ggplot(neg_by_year, aes(x = year, y = frac_negative)) +
geom_line(color = "red") +
labs(title = "Fraction of Negative CES Revisions by Year", y = "Fraction Negative", x = "Year")
largest_revision <- ces_full %>% slice_max(revision, n = 1)
smallest_revision <- ces_full %>% slice_min(revision, n = 1)
avg_post2020 <- ces_full %>% filter(year >= 2020) %>% summarize(avg_revision = mean(revision, na.rm = TRUE))
fact_check_stats <- list(
largest_revision = largest_revision,
smallest_revision = smallest_revision,
avg_post2020 = avg_post2020,
prop_test_claim1 = prop_test_claim1,
avg_rev_party = avg_rev_party
)
fact_check_stats
library(dplyr)
library(lubridate)
set.seed(123)
dates <- seq(as.Date("1980-01-01"), as.Date("2025-12-01"), by = "month")
n <- length(dates)
ces_levels <- data.frame(
date = dates,
level = round(cumsum(rnorm(n, mean = 100, sd = 50)), 0)
)
ces_revisions <- data.frame(
date = dates,
original = ces_levels$level + round(rnorm(n, 0, 50)),
final = ces_levels$level,
revision = ces_levels$level - (ces_levels$level + round(rnorm(n, 0, 50)))
)
ces_full <- ces_levels %>%
inner_join(ces_revisions, by = "date") %>%
mutate(
revision = revision,
revision_pct = abs(revision / final),
year = year(date)
)
t_test_avg <- t.test(ces_full$revision, mu = 0)
print(t_test_avg)
ces_full <- ces_full %>%
mutate(
post2000 = year >= 2000,
negative_revision = revision < 0,
post2020 = year >= 2020,
large_revision = revision_pct > 0.01
)
neg_counts <- ces_full %>%
group_by(post2000) %>%
summarize(neg_rev = sum(negative_revision, na.rm = TRUE),
total = n(), .groups = "drop")
prop_test_neg <- prop.test(x = neg_counts$neg_rev, n = neg_counts$total)
print(prop_test_neg)
large_counts <- ces_full %>%
group_by(post2020) %>%
summarize(large_rev = sum(large_revision, na.rm = TRUE),
total = n(), .groups = "drop")
prop_test_large <- prop.test(x = large_counts$large_rev, n = large_counts$total)
print(prop_test_large)
ces_full <- ces_full %>%
arrange(date) %>%
mutate(level_change = c(NA, diff(level)))
ces_corr <- cor.test(ces_full$revision[-1], ces_full$level_change[-1])
print(ces_corr)
if(length(unique(ces_full$post2020)) == 2){
t_test_post2020 <- t.test(revision ~ post2020, data = ces_full)
print(t_test_post2020)
} else {
message("t-test skipped: post2020 factor does not have 2 levels")
}
library(dplyr)
library(lubridate)
library(ggplot2)
library(tidyr)
set.seed(123)
dates <- seq(as.Date("1980-01-01"), as.Date("2025-12-01"), by = "month")
n <- length(dates)
ces_levels <- data.frame(
date = dates,
level = round(cumsum(rnorm(n, mean = 100, sd = 50)), 0)
)
ces_revisions <- data.frame(
date = dates,
original = ces_levels$level + round(rnorm(n, 0, 50)),
final = ces_levels$level,
revision = ces_levels$level - (ces_levels$level + round(rnorm(n, 0, 50)))
)
ces_full <- ces_levels %>%
inner_join(ces_revisions, by = "date") %>%
mutate(
revision_abs = revision,
revision_rel = abs(revision / final),
revision_pct = revision_rel,
year = year(date),
month = month(date, label = TRUE, abbr = FALSE)
)
presidents_party <- tidyr::expand_grid(
year = 1979:2025,
month = month.name,
president = NA_character_,
party = NA_character_
) %>%
mutate(president = case_when(
(month == "January") & (year == 1979) ~ "Carter",
(month == "February") & (year == 1981) ~ "Reagan",
(month == "February") & (year == 1989) ~ "Bush 41",
(month == "February") & (year == 1993) ~ "Clinton",
(month == "February") & (year == 2001) ~ "Bush 43",
(month == "February") & (year == 2009) ~ "Obama",
(month == "February") & (year == 2017) ~ "Trump I",
(month == "February") & (year == 2021) ~ "Biden",
(month == "February") & (year == 2025) ~ "Trump II",
TRUE ~ NA_character_
)) %>%
fill(president) %>%
mutate(party = if_else(president %in% c("Carter","Clinton","Obama","Biden"), "D", "R"))
ces_full_party <- ces_full %>%
left_join(presidents_party, by = c("year", "month"))
ces_post2020 <- ces_full %>%
filter(year >= 2020) %>%
mutate(negative_revision = revision < 0)
neg_counts <- ces_post2020 %>%
summarize(neg_rev = sum(negative_revision, na.rm = TRUE),
total = n())
prop_test_claim1 <- prop.test(neg_counts$neg_rev, neg_counts$total, p = 0.5)
print(prop_test_claim1)
ces_full_party <- ces_full_party %>%
mutate(abs_revision = abs(revision))
avg_rev_party <- ces_full_party %>%
group_by(party) %>%
summarize(avg_abs_revision = mean(abs_revision, na.rm = TRUE))
print(avg_rev_party)
if(length(unique(ces_full_party$party)) == 2){
t_test_party <- t.test(abs_revision ~ party, data = ces_full_party)
print(t_test_party)
}
ggplot(ces_full, aes(x = date, y = abs(revision))) +
geom_line(color = "purple") +
labs(title = "Absolute CES Revisions Over Time", y = "Absolute Revision", x = "Date")
neg_by_year <- ces_full %>%
group_by(year) %>%
summarize(frac_negative = mean(revision < 0, na.rm = TRUE))
ggplot(neg_by_year, aes(x = year, y = frac_negative)) +
geom_line(color = "red") +
labs(title = "Fraction of Negative CES Revisions by Year", y = "Fraction Negative", x = "Year")
largest_revision <- ces_full %>% slice_max(revision, n = 1)
smallest_revision <- ces_full %>% slice_min(revision, n = 1)
avg_post2020 <- ces_full %>% filter(year >= 2020) %>% summarize(avg_revision = mean(revision, na.rm = TRUE))
fact_check_stats <- list(
largest_revision = largest_revision,
smallest_revision = smallest_revision,
avg_post2020 = avg_post2020,
prop_test_claim1 = prop_test_claim1,
avg_rev_party = avg_rev_party
)
fact_check_stats
