(month == "February") & (year == 1989) ~ "Bush 41",
(month == "February") & (year == 1993) ~ "Clinton",
(month == "February") & (year == 2001) ~ "Bush 43",
(month == "February") & (year == 2009) ~ "Obama",
(month == "February") & (year == 2017) ~ "Trump I",
(month == "February") & (year == 2021) ~ "Biden",
(month == "February") & (year == 2025) ~ "Trump II",
TRUE ~ NA_character_
)) %>%
fill(president) %>%
mutate(party = if_else(president %in% c("Carter","Clinton","Obama","Biden"), "D", "R"))
ces_full_party <- ces_full %>%
left_join(presidents_party, by = c("year", "month")) %>%
mutate(abs_revision = abs(revision))
# Compute average absolute revision by party
avg_rev_party <- ces_full_party %>%
group_by(party) %>%
summarize(avg_abs_revision = mean(abs_revision, na.rm = TRUE))
print(avg_rev_party)
# Plot absolute CES revisions over time
ggplot(ces_full, aes(x = date, y = abs(revision))) +
geom_line(color = "purple") +
labs(title = "Absolute CES Revisions Over Time", y = "Absolute Revision", x = "Date")
# Fraction of negative revisions by year
neg_by_year <- ces_full %>%
group_by(year) %>%
summarize(frac_negative = mean(revision < 0, na.rm = TRUE))
ggplot(neg_by_year, aes(x = year, y = frac_negative)) +
geom_line(color = "red") +
labs(title = "Fraction of Negative CES Revisions by Year", y = "Fraction Negative", x = "Year")
# Keep only avg_rev_party in final list
fact_check_stats <- list(
avg_rev_party = avg_rev_party
)
fact_check_stats
library(dplyr)
library(lubridate)
library(ggplot2)
library(tidyr)
set.seed(123)
dates <- seq(as.Date("1980-01-01"), as.Date("2025-12-01"), by = "month")
n <- length(dates)
# Generate CES levels
ces_levels <- data.frame(
date = dates,
level = round(cumsum(rnorm(n, mean = 100, sd = 50)), 0)
)
# Generate CES revisions
ces_revisions <- data.frame(
date = dates,
original = ces_levels$level + round(rnorm(n, 0, 50)),
final = ces_levels$level,
revision = ces_levels$level - (ces_levels$level + round(rnorm(n, 0, 50)))
)
# Combine levels and revisions
ces_full <- ces_levels %>%
inner_join(ces_revisions, by = "date") %>%
mutate(
revision_abs = revision,
revision_rel = abs(revision / final),
year = year(date),
month = month(date, label = TRUE, abbr = FALSE)
)
# Plot absolute CES revisions over time
ggplot(ces_full, aes(x = date, y = abs(revision))) +
geom_line(color = "purple") +
labs(title = "Absolute CES Revisions Over Time", y = "Absolute Revision", x = "Date") +
theme_minimal()
# Fraction of negative revisions by year
neg_by_year <- ces_full %>%
group_by(year) %>%
summarize(frac_negative = mean(revision < 0, na.rm = TRUE))
ggplot(neg_by_year, aes(x = year, y = frac_negative)) +
geom_line(color = "red") +
labs(title = "Fraction of Negative CES Revisions by Year", y = "Fraction Negative", x = "Year") +
theme_minimal()
# --- Load libraries quietly ---
suppressPackageStartupMessages(library(httr2))
suppressPackageStartupMessages(library(rvest))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(tidyr))
suppressPackageStartupMessages(library(lubridate))
suppressPackageStartupMessages(library(stringr))
# --- URL and request ---
url <- "https://data.bls.gov/pdq/SurveyOutputServlet"
resp <- request(url) %>%
req_method("POST") %>%
req_body_form(
request_action = "get_data",
reformat = "true",
from_results_page = "true",
from_year = "1979",
to_year = "2025",
Go.x = "11",
Go.y = "10",
initial_request = "false",
data_tool = "surveymost",
series_id = "CES0000000001",
original_annualAveragesRequested = "false"
) %>%
req_perform()
# --- Load libraries quietly ---
suppressPackageStartupMessages(library(httr2))
suppressPackageStartupMessages(library(rvest))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(tidyr))
suppressPackageStartupMessages(library(lubridate))
suppressPackageStartupMessages(library(stringr))
# --- URL and request ---
url <- "https://data.bls.gov/pdq/SurveyOutputServlet"
resp <- request(url) %>%
req_method("POST") %>%
req_body_form(
request_action = "get_data",
reformat = "true",
from_results_page = "true",
from_year = "1979",
to_year = "2025",
Go.x = "11",
Go.y = "10",
initial_request = "false",
data_tool = "surveymost",
series_id = "CES0000000001",
original_annualAveragesRequested = "false"
) %>%
req_perform()
# --- Load libraries quietly ---
suppressPackageStartupMessages(library(httr2))
suppressPackageStartupMessages(library(rvest))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(tidyr))
suppressPackageStartupMessages(library(lubridate))
suppressPackageStartupMessages(library(stringr))
# --- URL and request ---
url <- "https://data.bls.gov/pdq/SurveyOutputServlet"
resp <- request(url) %>%
req_method("POST") %>%
req_body_form(
request_action = "get_data",
reformat = "true",
from_results_page = "true",
from_year = "1979",
to_year = "2025",
Go.x = "11",
Go.y = "10",
initial_request = "false",
data_tool = "surveymost",
series_id = "CES0000000001",
original_annualAveragesRequested = "false"
) %>%
req_perform()
html <- resp %>% resp_body_html()
# --- Extract table ---
tables <- html %>% html_elements("table")
raw_table <- tables[[2]] %>% html_table(fill = TRUE)
colnames(raw_table) <- str_trim(raw_table[1, ])
raw_table <- raw_table[-1, ]
colnames(raw_table)[1] <- "Year"
# --- Clean and reshape ---
ces_df <- suppressWarnings(
raw_table %>%
pivot_longer(cols = -Year, names_to = "month", values_to = "level") %>%
filter(!is.na(level) & level != "") %>%
mutate(
month_num = match(substr(month, 1, 3), month.abb),
date = ym(paste(Year, month_num)),
level = as.numeric(gsub(",", "", level))
) %>%
select(date, level) %>%
arrange(date)
)
# --- Preview ---
head(ces_df)
tail(ces_df)
# Render the Quarto document
quarto::quarto_render("mp04.qmd")
quarto::quarto_render("mp04.qmd", output_dir = "docs")
quarto::quarto_render("mp04.qmd")
list.files("docs")
library(ggplot2)
library(dplyr)
income_data <- data.frame(
Category = c("Median Household Income",
"Emotional Well Being",
"Income Satiation for Life Evaluation"),
Amount = c(68703, 70000, 105000)
)
ggplot(income_data, aes(x = Amount, y = reorder(Category, Amount))) +
geom_col(fill = "#4B9CD3") +
geom_text(aes(label = paste0("$", format(Amount, big.mark=","))),
hjust = -0.1, size = 5) +
scale_x_continuous(labels = scales::dollar_format(),
expand = expansion(mult = c(0, 0.15))) +
labs(
title = "US Household Income & Happiness Levels",
x = "Annual Income",
y = ""
) +
theme_minimal(base_size = 14) +
theme(plot.title = element_text(hjust = 0.5))
library(ggplot2)
library(dplyr)
set.seed(123)
income <- sort(rlnorm(200, meanlog = 10.5, sdlog = 0.35))
income <- pmin(income, 150000)
true_happiness <- 1 - exp(-income / 25000)
happiness <- true_happiness + rnorm(200, mean = 0, sd = 0.05)
happiness <- pmin(pmax(happiness, 0), 1)
data <- data.frame(
Income = income,
Happiness = happiness
)
ggplot(data, aes(x = Income, y = Happiness)) +
geom_point(alpha = 0.6, size = 2.3) +
geom_smooth(se = FALSE, linewidth = 1.2, color = "blue") +
scale_x_continuous(labels = scales::dollar_format()) +
labs(
title = "Income vs. Happiness at the Individual Level",
subtitle = "Strong gains at low incomes with diminishing returns after ~$60k",
x = "Income",
y = "Happiness (0–1 scale)"
) +
theme_minimal(base_size = 15) +
theme(
plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5)
)
# Assume 'h' is preloaded country-level dataset
h <- h %>%
mutate(IncomeGroup = case_when(
`Economy..GDP.per.Capita.` < 0.5 ~ "Low",
`Economy..GDP.per.Capita.` < 1.5 ~ "Medium",
TRUE ~ "High"
))
library(ggplot2)
library(scales)
library(dplyr)
# Create an income group for coloring
h <- h %>%
mutate(IncomeGroup = case_when(
`Economy..GDP.per.Capita.` < 0.5 ~ "Low",
`Economy..GDP.per.Capita.` < 1.5 ~ "Medium",
TRUE ~ "High"
))
library(ggplot2)
library(scales)
library(dplyr)
# Enhanced scatter plot
ggplot(h, aes(x = `Economy..GDP.per.Capita.`, y = `Happiness.Score`,
color = IncomeGroup, label = Country)) +
geom_point(size = 4, alpha = 0.8) +
geom_smooth(method = "lm", color = "black", linetype = "dashed", se = FALSE) +
geom_text(vjust = -0.8, size = 3) +
scale_x_log10(name = "GDP per Capita (log scale)") +
scale_y_continuous(name = "Happiness Score (0–10)") +
scale_color_manual(values = c("Low" = "#fc8d59", "Medium" = "#fee08b", "High" = "#91bfdb")) +
labs(title = "Happiness vs GDP per Capita Across Countries",
color = "Income Group") +
theme_minimal(base_size = 14) +
theme(
legend.position = "top",
plot.title = element_text(face = "bold", size = 16),
axis.title = element_text(face = "bold", size = 14)
)
library(ggplot2)
library(scales)
library(dplyr)
# Create an income group for coloring
h <- h %>%
mutate(IncomeGroup = case_when(
`Economy..GDP.per.Capita.` < 0.5 ~ "Low",
`Economy..GDP.per.Capita.` < 1.5 ~ "Medium",
TRUE ~ "High"
))
# Load libraries
library(ggplot2)
library(dplyr)
library(scales)
# Download the dataset directly from GitHub
h <- read.csv("https://raw.githubusercontent.com/kirenz/datasets/master/happy.csv")
# Check the first few rows
head(h)
# Create an income group for coloring
h <- h %>%
mutate(IncomeGroup = case_when(
`Economy..GDP.per.Capita.` < 0.5 ~ "Low",
`Economy..GDP.per.Capita.` < 1.5 ~ "Medium",
TRUE ~ "High"
))
# Enhanced scatter plot
ggplot(h, aes(x = `Economy..GDP.per.Capita.`, y = `Happiness.Score`,
color = IncomeGroup, label = Country)) +
geom_point(size = 4, alpha = 0.8) +
geom_smooth(method = "lm", color = "black", linetype = "dashed", se = FALSE) +
geom_text(vjust = -0.8, size = 3) +
scale_x_log10(name = "GDP per Capita (log scale)") +
scale_y_continuous(name = "Happiness Score (0–10)") +
scale_color_manual(values = c("Low" = "#fc8d59", "Medium" = "#fee08b", "High" = "#91bfdb")) +
labs(title = "Happiness vs GDP per Capita Across Countries",
color = "Income Group") +
theme_minimal(base_size = 14) +
theme(
legend.position = "top",
plot.title = element_text(face = "bold", size = 16),
axis.title = element_text(face = "bold", size = 14)
)
library(ggplot2)
library(dplyr)
set.seed(123)
income <- sort(rlnorm(200, meanlog = 10.5, sdlog = 0.35))
income <- pmin(income, 150000)
true_happiness <- 1 - exp(-income / 25000)
happiness <- true_happiness + rnorm(200, mean = 0, sd = 0.05)
happiness <- pmin(pmax(happiness, 0), 1)
data <- data.frame(
Income = income,
Happiness = happiness
)
ggplot(data, aes(x = Income, y = Happiness)) +
geom_point(alpha = 0.6, size = 2.3) +
geom_smooth(se = FALSE, linewidth = 1.2, color = "blue") +
scale_x_continuous(labels = scales::dollar_format()) +
labs(
title = "Income vs. Happiness at the Individual Level",
subtitle = "Strong gains at low incomes with diminishing returns after ~$60k",
x = "Income",
y = "Happiness (0–1 scale)"
) +
theme_minimal(base_size = 15) +
theme(
plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5)
)
library(ggplot2)
library(dplyr)
library(scales)
# Download the dataset directly from GitHub
h <- read.csv("https://raw.githubusercontent.com/kirenz/datasets/master/happy.csv")
# Check the first few rows
head(h)
# Create an income group for coloring
h <- h %>%
mutate(IncomeGroup = case_when(
`Economy..GDP.per.Capita.` < 0.5 ~ "Low",
`Economy..GDP.per.Capita.` < 1.5 ~ "Medium",
TRUE ~ "High"
))
# Enhanced scatter plot
ggplot(h, aes(x = `Economy..GDP.per.Capita.`, y = `Happiness.Score`,
color = IncomeGroup, label = Country)) +
geom_point(size = 4, alpha = 0.8) +
geom_smooth(method = "lm", color = "black", linetype = "dashed", se = FALSE) +
geom_text(vjust = -0.8, size = 3) +
scale_x_log10(name = "GDP per Capita (log scale)") +
scale_y_continuous(name = "Happiness Score (0–10)") +
scale_color_manual(values = c("Low" = "#fc8d59", "Medium" = "#fee08b", "High" = "#91bfdb")) +
labs(title = "Happiness vs GDP per Capita Across Countries",
color = "Income Group") +
theme_minimal(base_size = 14) +
theme(
legend.position = "top",
plot.title = element_text(face = "bold", size = 16),
axis.title = element_text(face = "bold", size = 14)
)
library(ggplot2)
library(dplyr)
library(scales)
# Download the dataset directly from GitHub
h <- read.csv("https://raw.githubusercontent.com/kirenz/datasets/master/happy.csv")
# Check the first few rows
head(h)
# Create an income group for coloring
h <- h %>%
mutate(IncomeGroup = case_when(
`Economy..GDP.per.Capita.` < 0.5 ~ "Low",
`Economy..GDP.per.Capita.` < 1.5 ~ "Medium",
TRUE ~ "High"
))
# Enhanced scatter plot
ggplot(h, aes(x = `Economy..GDP.per.Capita.`, y = `Happiness.Score`,
color = IncomeGroup, label = Country)) +
geom_point(size = 4, alpha = 0.8) +
geom_smooth(method = "lm", color = "black", linetype = "dashed", se = FALSE) +
geom_text(vjust = -0.8, size = 3) +
scale_x_log10(name = "GDP per Capita (log scale)") +
scale_y_continuous(name = "Happiness Score (0–10)") +
scale_color_manual(values = c("Low" = "#fc8d59", "Medium" = "#fee08b", "High" = "#91bfdb")) +
labs(title = "Happiness vs GDP per Capita Across Countries",
color = "Income Group") +
theme_minimal(base_size = 14) +
theme(
legend.position = "top",
plot.title = element_text(face = "bold", size = 16),
axis.title = element_text(face = "bold", size = 14)
)
library(ggplot2)
library(dplyr)
set.seed(123)
income <- sort(rlnorm(200, meanlog = 10.5, sdlog = 0.35))
income <- pmin(income, 150000)
true_happiness <- 1 - exp(-income / 25000)
happiness <- true_happiness + rnorm(200, mean = 0, sd = 0.05)
happiness <- pmin(pmax(happiness, 0), 1)
data <- data.frame(
Income = income,
Happiness = happiness
)
ggplot(data, aes(x = Income, y = Happiness)) +
geom_point(alpha = 0.6, size = 2.3) +
scale_x_continuous(labels = scales::dollar_format()) +
labs(
title = "Income vs. Happiness at the Individual Level",
subtitle = "Strong gains at low incomes with diminishing returns after ~$60k",
x = "Income",
y = "Happiness (0–1 scale)"
) +
theme_minimal(base_size = 15) +
theme(
plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5)
)
library(ggplot2)
library(dplyr)
set.seed(123)   # for reproducibility
# Generate realistic income values (skewed toward lower incomes)
income <- sort(rlnorm(200, meanlog = 10.5, sdlog = 0.35))
income <- pmin(income, 150000)  # cap at 150k
# True diminishing returns curve
true_happiness <- 1 - exp(-income / 25000)
# Add realistic noise (survey variation)
happiness <- true_happiness + rnorm(200, mean = 0, sd = 0.05)
happiness <- pmin(pmax(happiness, 0), 1)  # keep between 0 and 1
data <- data.frame(
Income = income,
Happiness = happiness
)
ggplot(data, aes(x = Income, y = Happiness)) +
geom_point(alpha = 0.6, size = 2.3) +    # scatter points
geom_smooth(se = FALSE, linewidth = 1.2, color = "blue") +  # trend line
scale_x_continuous(labels = scales::dollar_format()) +
labs(
title = "Income vs. Happiness",
subtitle = "Strong happiness gains at low incomes, diminishing returns after ~$60k",
x = "Income",
y = "Happiness (0–1 scale)"
) +
theme_minimal(base_size = 15) +
theme(
plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5)
)
library(ggplot2)
library(dplyr)
set.seed(123)   # for reproducibility
# Generate realistic income values (skewed toward lower incomes)
income <- sort(rlnorm(200, meanlog = 10.5, sdlog = 0.35))
income <- pmin(income, 150000)  # cap at 150k
# True diminishing returns curve
true_happiness <- 1 - exp(-income / 25000)
# Add realistic noise (survey variation)
happiness <- true_happiness + rnorm(200, mean = 0, sd = 0.05)
happiness <- pmin(pmax(happiness, 0), 1)  # keep between 0 and 1
data <- data.frame(
Income = income,
Happiness = happiness
)
ggplot(data, aes(x = Income, y = Happiness)) +
geom_point(alpha = 0.6, size = 2.3) +    # scatter points
geom_smooth(se = FALSE, linewidth = 1.2, color = "blue") +  # trend line
scale_x_continuous(labels = scales::dollar_format()) +
labs(
title = "Income vs. Happiness",
subtitle = "Strong happiness gains at low incomes, diminishing returns after ~$60k",
x = "Income",
y = "Happiness (0–1 scale)"
) +
theme_minimal(base_size = 15) +
theme(
plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5)
)
library(ggplot2)
library(dplyr)
library(scales)
# Download the dataset directly from GitHub
h <- read.csv("https://raw.githubusercontent.com/kirenz/datasets/master/happy.csv")
# Check the first few rows
head(h)
# Create an income group for coloring
h <- h %>%
mutate(IncomeGroup = case_when(
`Economy..GDP.per.Capita.` < 0.5 ~ "Low",
`Economy..GDP.per.Capita.` < 1.5 ~ "Medium",
TRUE ~ "High"
))
# Enhanced scatter plot
ggplot(h, aes(x = `Economy..GDP.per.Capita.`, y = `Happiness.Score`,
color = IncomeGroup, label = Country)) +
geom_point(size = 4, alpha = 0.8) +
geom_smooth(method = "lm", color = "black", linetype = "dashed", se = FALSE) +
geom_text(vjust = -0.8, size = 3) +
scale_x_log10(name = "GDP per Capita (log scale)") +
scale_y_continuous(name = "Happiness Score (0–10)") +
scale_color_manual(values = c("Low" = "#fc8d59", "Medium" = "#fee08b", "High" = "#91bfdb")) +
labs(title = "Happiness vs GDP per Capita Across Countries",
color = "Income Group") +
theme_minimal(base_size = 14) +
theme(
legend.position = "top",
plot.title = element_text(face = "bold", size = 16),
axis.title = element_text(face = "bold", size = 14)
)
