<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nuzhat Shahriyar">

<title>Does making more money make people happier? – STA 9750 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-339e78669bd22224b7cb5e9437fe940b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Does making more money make people happier?</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Nuzhat Shahriyar </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Happiness is becoming more widely acknowledged as an important indicator of a society’s development, supporting more traditional economic metrics like GDP. GDP underestimates people’s well-being or general quality of life, even though it does reflect material wealth. Reports of happiness can differ significantly between countries and cultures, even between those with comparable finances.</p>
<p>Many individuals believe that the primary factor influencing happiness is one’s income. Increasing income may ease financial strain, provide access to healthcare, education, relaxation, and create chances for personal development and satisfaction. However, the relationship between happiness and income is not clear-cut. <strong>Diminishing marginal utility</strong> is the idea that after a certain amount of money, happiness rises less and less with each new dollar. Policymakers, economists, and social scientists need to understand this complex link in order to better understand initiatives for enhancing societal well-being.</p>
<p>In the 1970s, Richard Easterlin conducted one of the most important studies in happiness economics, which discovered that within a single country, those with higher earnings tended to report higher levels of happiness. However, average wealth could not consistently predict national happiness when comparing countries. A problem that came to be known as the <strong>Easterlin Paradox</strong>. Further research have given depth to this outcome, showing that while social support, governance, and cultural norms have a greater influence on happiness for wealthier people, income has a greater impact on happiness for individuals at lower income levels. This paradox emphasizes the significance of examining data at both the individual and national levels in order to fully understand the relationship between wealth and happiness.</p>
<p>Happiness is a complex idea rather than a single, straightforward one. Researchers frequently distinguish between <strong>life satisfaction</strong>, which represents a more thoughtful assessment of overall life quality, and emotional well-being, which incorporates common emotions like joy, tension, and fulfillment. While life satisfaction might continue to rise with more wealth, emotional well-being tends to settle once fundamental requirements are satisfied. It is crucial to understand these many elements of happiness in order to evaluate the full impact of wealth and to develop policies that prioritize the components of well-being that are most important to individuals.</p>
<p>This report addresses the specific question:</p>
<p><strong>Does making more money make people happier, and if so, to what extent?</strong></p>
<p>By examining both individual-level and country-level data, this report contributes to the overarching project question: <strong>Which countries are the happiest in the world and why?</strong> By examining trends, turning points, and outliers in the connection between income and happiness, the research provides insights that become clear when many datasets are linked together. The goal of the research is to quantify the relationship between wealth and happiness while taking into account the many aspects of well-being.</p>
</section>
<section id="data-sources-and-methodology" class="level1">
<h1>Data Sources and Methodology</h1>
<p>The primary data source for this analysis is the <strong>World Happiness Report</strong>, a public dataset providing annual happiness scores for countries worldwide. This dataset is taken from survey responses in which individuals rate their lives on a 0–10 scale. In addition to the overall happiness score, the dataset includes explanatory variables such as GDP per capita, social support, freedom, health, and different understandings of corruption. GDP per capita serves as a tool for national income, facilitating comparisons across countries.</p>
<p>Using various sample techniques, the World Happiness Report surveys thousands of people in every country that participates to guarantee accuracy. In addition to answering questions about social, institutional, and economic factors, participants rate their level of life happiness at the moment. By using a comprehensive method, researchers can determine how wealth affects happiness both directly and indirectly. Crucially, survey-based metrics capture <strong>subjective well-being</strong>, which may be different from simply objective measurements of life satisfaction.</p>
<p>Income and happiness statistics at an individual level were taken to demonstrate data at the national level. A thorough examination of non-linear effects, limitations, and diminishing returns that might not be apparent in aggregate country-level data is made possible by individual-level data. In order to avoid confusion from extreme outliers, income values were capped at $150,000 and created using a log-normal distribution, which reflects the skewed character of real-world income distributions.</p>
<hr>
<section id="data-cleaning-and-preparation" class="level2">
<h2 class="anchored" data-anchor-id="data-cleaning-and-preparation">Data Cleaning and Preparation</h2>
<p>Several preprocessing steps were undertaken:</p>
<ul>
<li><strong>Country-level data</strong>: Only countries with complete GDP per capita and happiness score data were included, resulting in 157 countries. Missing or incomplete entries were excluded to avoid introducing bias.</li>
<li><strong>Variable scaling</strong>: GDP per capita values were log-transformed for visualization, which better represents the wide range of incomes among countries, especially at lower income levels.</li>
<li><strong>Categorization</strong>: Countries were grouped into low, medium, and high-income categories based on GDP per capita relative to global medians to enhance interpretability.</li>
<li><strong>Individual-level data</strong>: Income was combined with a non-linear happiness function to reflect diminishing returns, allowing exploration of patterns not apparent in country-level analysis.</li>
<li><strong>Exploratory data analysis (EDA)</strong>: Visualizations of distributions, correlations, and outliers were performed to confirm expected patterns and ensure suitability for regression and plotting.</li>
</ul>
<p>The analysis utilizes scatter plots, bar charts, and trend lines generated using the <code>ggplot2</code> and <code>dplyr</code> packages in R. Visualizations illustrate non-linear effects, thresholds, and variability across countries and individuals. Logarithmic scaling, color-coding, and annotations highlight important features such as diminishing returns and exceptions to general patterns.</p>
</section>
</section>
<section id="income-thresholds-and-dimensions-of-happiness" class="level1">
<h1>Income Thresholds and Dimensions of Happiness</h1>
<p>Income influences emotional well-being and life satisfaction differently. Emotional well-being improves rapidly at low-income levels but changes once basic needs are met. Life satisfaction continues to rise with income, reflecting broader life evaluations. Understanding these thresholds is critical for policy: income increases can have substantial effects on daily happiness, while higher incomes may primarily affect reflective life evaluations.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IndividualReport_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Figure 1:</strong> The comparison of median U.S. household income with estimated income thresholds for emotional well-being and life satisfaction reveals important insights into how income shapes different dimensions of happiness. As shown in Figure 1, emotional well-being increases sharply with income up to approximately $70,000 per year, suggesting that attaining basic financial security and the ability to meet essential needs has a substantial impact on daily mood, stress levels, and general life satisfaction. Beyond this threshold, additional income has a relatively small effect on emotional well-being. This indicates that once basic needs and moderate comforts are met, other factors such as personal relationships, health, community engagement, and work–life balance play a more significant role in influencing day-to-day happiness. In contrast, overall life satisfaction reflects a broader, long-term evaluation of one’s life circumstances continues to rise until roughly $105,000 per year. This distinction highlights how different aspects of well-being are impacted by income in different ways. Higher-income households may need additional non-monetary supports to improve their overall life satisfaction, while lower-income households experience significant gains in immediate emotional well-being from even low-income increases. These results have important implications for social planning and policy. While efforts to increase overall life satisfaction among higher-income populations may benefit from additional interventions like promoting health and wellness, supporting relationships with others, encouraging work-life balance, and encouraging community involvement and civic engagement, programs that increase income or provide targeted financial support for low- and middle-income families may lead to significant improvements in everyday happiness. Policymakers and organizations may better adapt policies that enhance life satisfaction and emotional well-being across a range of income levels by acknowledging the diverse effects of income. This ensures that resources are used efficiently to improve overall social happiness.</p>
</section>
<section id="individual-level-diminishing-returns" class="level1">
<h1>Individual-Level Diminishing Returns</h1>
<p>At the individual level, the effect of income on happiness exhibits a clear pattern of diminishing returns.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IndividualReport_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Figure 2:</strong> The relationship between income and individual happiness demonstrates a clear pattern of diminishing returns. The figure illustrates that at lower income levels, even small increases in earnings can create substantial improvements in emotional well-being and life satisfaction, as individuals gain access to basic needs, financial security, and opportunities for personal growth. However, this effect begins to taper off once income reaches approximately $50,000–$60,000 per year, after which additional income contributes progressively smaller gains in happiness. This non-linear relationship suggests that while financial resources are important for improving quality of life, they cannot fully compensate for other factors that influence well-being, such as social support, health, work–life balance, and cultural values. In other words, while addressing non-economic factors that maintain long-term satisfaction and life fulfillment, initiatives and measures focused on increasing happiness should prioritize supporting low- and middle-income populations, where gradual financial improvements have the greatest impact. Furthermore, the statistic emphasizes the significance of placing money within larger social and psychological structures, showing that an integrated approach is required for understanding and maximizing individual well-being and that money alone is not a definite route to happiness.</p>
</section>
<section id="cross-country-analysis-of-income-and-happiness" class="level1">
<h1>Cross-Country Analysis of Income and Happiness</h1>
<p>To examine the relationship between income and happiness at the country level, GDP per capita was compared to national happiness scores from the World Happiness Report. Countries were categorized into low, medium, and high-income groups, and a log scale was applied to GDP to better visualize the wide range of incomes.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  X     Country Happiness.Score Economy..GDP.per.Capita.  Family
1 1     Denmark           7.526                  1.44178 1.16374
2 2 Switzerland           7.509                  1.52733 1.14524
3 3     Iceland           7.501                  1.42666 1.18326
4 4      Norway           7.498                  1.57744 1.12690
5 5     Finland           7.413                  1.40598 1.13464
6 6      Canada           7.404                  1.44015 1.09610
  Health..Life.Expectancy. Trust..Government.Corruption.
1                  0.79504                       0.44453
2                  0.86303                       0.41203
3                  0.86733                       0.14975
4                  0.79579                       0.35776
5                  0.81091                       0.41004
6                  0.82760                       0.31329</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in scale_x_log10(name = "GDP per Capita (log scale)"): log-10 transformation introduced infinite values.
log-10 transformation introduced infinite values.
log-10 transformation introduced infinite values.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 row containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IndividualReport_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Figure 3:</strong> A scatter plot of GDP per capita versus happiness scores for countries around the world, with points color-coded by income group and a dashed trend line illustrating the overall relationship. The plot reveals a clear positive correlation, indicating that wealthier countries generally report higher happiness scores. However, the trend line flattens at higher GDP levels, demonstrating diminishing returns, where additional income contributes less to happiness in wealthier countries. There are important exceptions: some high-income nations report lower-than-expected happiness, emphasizing the relevance of cultural, institutional, and social factors, while certain lower-income countries, like Costa Rica and Bhutan, experience high happiness due to strong social support and governance. These trends imply that social networks, trust in the government, efficient institutions, and work-life balance are all important factors in determining happiness and that wealth is not the only factor. Overall, Figure 3 highlights the need for an integrated approach that incorporates social, cultural, and institutional factors in addition to economic growth in order to improve national well-being.</p>
</section>
<section id="integration-with-broader-happiness-factors" class="level1">
<h1>Integration With Broader Happiness Factors</h1>
<p>Income alone does not explain why some countries are happier. By combining this analysis with other project components—such as corruption perception and vacation days, clearer picture emerges:</p>
<ul>
<li><strong>Social and institutional quality:</strong> Countries with similar income levels may differ in happiness due to governance, trust in institutions, and public services.<br>
</li>
<li><strong>Work–life balance:</strong> Vacation days and leisure time affect life satisfaction independently of income.<br>
</li>
<li><strong>Cultural norms:</strong> The link between income and happiness is influenced by attitudes regarding money, consumption, and relationships.</li>
</ul>
<p>This integrated view allows identifying patterns that individual analyses would miss, reinforcing that the happiest countries combine economic resources with supportive social and institutional frameworks.</p>
</section>
<section id="limitations-and-moving-beyond-correlation" class="level1">
<h1>Limitations and Moving Beyond Correlation</h1>
<p>Several limitations must be acknowledged:</p>
<ol type="1">
<li><strong>Causality:</strong> Correlation does not imply causation. Higher income may lead to greater happiness, but happier individuals may also pursue higher-paying opportunities.<br>
</li>
<li><strong>Data quality:</strong> World Happiness Report surveys may contain self-report bias, cultural differences, or sampling limitations.<br>
</li>
<li><strong>Unobserved variables:</strong> Factors such as health, family structure, and climate can confuse income–happiness relationships.<br>
</li>
<li><strong>Temporal limitations:</strong> GDP per capita and happiness are often measured annually, but long-term trends may be missed.</li>
</ol>
<p>Further research might use regression modeling or complex causal inference approaches to go beyond correlation. Stronger explanations regarding how changes in income impact happiness over time might be made by including information from panels or continuous surveys.</p>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>This report shows that income is a significant factor of happiness, but its effect demonstrates clear <strong>diminishing returns</strong> beyond moderate income levels. At the individual level, emotional well-being rises sharply with increases in income among low- and middle-income earners, reflecting the critical role of financial resources in securing basic needs, reducing stress, and providing access to goods, services, and opportunities that directly enhance day-to-day life satisfaction. However, once a household reaches moderate income levels, additional financial gains contribute progressively smaller improvements to emotional well-being, suggesting that factors beyond income such as social relationships, physical and mental health, work–life balance, and personal fulfillment become increasingly important determinants of happiness. Life satisfaction, which represents a broader, long-term evaluation of one’s circumstances, continues to benefit from higher income, though at a slower rate, indicating that wealth can still enhance opportunities, personal development, and perceived life stability even after immediate needs are met.</p>
<p>At the national level, GDP per capita explains part of the variation in happiness across countries, but the presence of notable exceptions highlights the importance of social, institutional, and cultural factors. Countries that successfully demonstrate economic resources into well-being do so by linking financial stability with strong social support networks, effective and transparent institutions, low levels of corruption, and policies that promote a balanced lifestyle and healthy work–life integration. However, countries with high GDP per capita but weaker social institutions or lower levels of trust in governance often fail to achieve the happiness levels predicted by their economic wealth alone. This demonstrates that economic wealth is necessary but not sufficient for creating collective well-being, and that the broader social and institutional context plays a decisive role in shaping happiness outcomes.</p>
<p>These findings highlight the limitations of policies that focus specifically on increasing economic growth. While financial development is important, maximizing societal happiness requires complementary strategies that strengthen institutional quality, strengthen welfare systems, encourage healthy lives, and advance public health and education. By addressing these non-economic aspects of well-being, initiatives can enhance the benefits of income and guarantee that increases in wealth result in long-lasting increases in happiness. In conclusion, although income is unquestionably significant, <strong>money alone does not guarantee happiness</strong>; long-term well-being results from the relationship between financial resources with institutional, social, and cultural supports that collectively shape quality of life in both individual and national contexts.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/github\.com\/nuzhats28\/STA9750-2025-FALL\.git");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>